import{u as I,r as n,j as e,e as k,w as B,C as D,U as F,x as M,A as H,y as W}from"./react-vendor-B5RUpvsH.js";import{u as q,C as T,b as P,a as z,e as h,d as j}from"./index-BPJ2Iszk.js";import{G as O,n as $,d as b,e as E,p as v,r as w,t as V,v as J}from"./firebase-C7cuFLc_.js";import"./vendor-57qY9EKr.js";const Z=()=>{const r=I(),{user:y,role:g,setRole:o}=q();n.useEffect(()=>{y&&g&&r(g==="admin"?"/admin":"/")},[y,g,r]);const[u,N]=n.useState("customer"),[l,x]=n.useState(!1),[A,t]=n.useState(""),[f,R]=n.useState(""),[p,S]=n.useState(""),[d,L]=n.useState(!1),U=async()=>{t(""),x(!0);const i=new O;try{const s=(await $(h,i)).user,c=b(j,"users",s.uid),m=await E(c);if(!m.exists())await v(c,{uid:s.uid,displayName:s.displayName,email:s.email,photoURL:s.photoURL,role:"customer",createdAt:w()}),o("customer");else{const C=m.data();o(C.role||"customer")}r("/")}catch(a){console.error("Google Auth Error:",a),t("Failed to sign in with Google. Please try again.")}finally{x(!1)}},G=async i=>{i.preventDefault(),t(""),x(!0);try{let a,s;if(d)a=await V(h,f,p),s=a.user,await v(b(j,"users",s.uid),{uid:s.uid,email:s.email,role:"admin",createdAt:w()}),o("admin"),r("/admin");else{a=await J(h,f,p),s=a.user;const c=b(j,"users",s.uid),m=await E(c);m.exists()?m.data().role==="admin"?(o("admin"),r("/admin")):(t("Access denied. Admin privileges required."),await h.signOut()):(console.log("User auth exists but no firestore doc. Creating admin doc."),await v(c,{uid:s.uid,email:s.email,role:"admin",createdAt:w()}),o("admin"),r("/admin"))}}catch(a){console.error(a),a.code==="auth/email-already-in-use"?t("Email already in use. Please login."):a.code==="auth/wrong-password"?t("Invalid password."):a.code==="auth/user-not-found"?t("User not found. Please register."):t("Authentication failed. Check credentials.")}finally{x(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-cream p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-5%] w-64 h-64 bg-sage/20 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-[-10%] right-[-5%] w-80 h-80 bg-terracotta/10 rounded-full blur-3xl animate-pulse delay-1000"}),e.jsxs(T,{className:"w-full max-w-md p-8 md:p-12 relative z-10 flex flex-col gap-8 animate-fade-in-up",children:[e.jsx("div",{className:"absolute top-4 left-4 z-20",children:e.jsxs(k,{to:"/",className:"flex items-center gap-2 text-sage hover:text-terracotta transition-colors font-semibold text-sm group",children:[e.jsx(B,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),"Back to Home"]})}),e.jsxs("div",{className:"text-center mt-6",children:[e.jsx("h1",{className:"text-4xl font-bold text-terracotta mb-2",children:"Welcome"}),e.jsx("p",{className:"text-sage font-medium",children:"Please sign in to continue"})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{N("customer"),t("")},className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${u==="customer"?"bg-white text-terracotta shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Customer"}),e.jsx("button",{onClick:()=>{N("admin"),t("")},className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${u==="admin"?"bg-white text-terracotta shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Admin"})]}),A&&e.jsxs("div",{className:"bg-red-50 text-red-500 p-4 rounded-xl flex items-center gap-2 text-sm font-medium border border-red-100 animate-shake break-words",children:[e.jsx(D,{size:18,className:"shrink-0"}),e.jsx("span",{children:A})]}),u==="customer"&&e.jsxs("div",{className:"flex flex-col gap-6 py-4 animate-fade-in",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-sage font-medium",children:"Sign in to track orders, save addresses, and more."}),e.jsx("button",{onClick:U,disabled:l,className:"w-full flex items-center justify-center gap-3 bg-white text-charcoal font-bold py-4 rounded-xl shadow-md border border-gray-100 hover:bg-gray-50 hover:shadow-lg transition-all transform hover:-translate-y-1 active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed disabled:transform-none",children:l?e.jsx("span",{className:"flex items-center gap-2",children:"Processing..."}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),e.jsx("span",{children:"Continue with Google"})]})})]}),e.jsxs("div",{className:"relative flex py-2 items-center",children:[e.jsx("div",{className:"flex-grow border-t border-gray-200"}),e.jsx("span",{className:"flex-shrink-0 mx-4 text-gray-400 text-xs uppercase tracking-widest",children:"Or"}),e.jsx("div",{className:"flex-grow border-t border-gray-200"})]}),e.jsx(k,{to:"/menu",className:"w-full",children:e.jsx(P,{variant:"secondary",className:"w-full justify-center",children:"Browse Menu as Guest"})})]}),u==="admin"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("form",{onSubmit:G,className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-sage ml-4 uppercase tracking-widest",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{type:"email",placeholder:"admin@fakekitchen.com",className:"pl-12",value:f,onChange:i=>R(i.target.value),required:!0,disabled:l}),e.jsx(F,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-sage/60",size:20})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-sage ml-4 uppercase tracking-widest",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{type:"password",placeholder:"••••••••",className:"pl-12",value:p,onChange:i=>S(i.target.value),required:!0,disabled:l}),e.jsx(M,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-sage/60",size:20})]})]}),e.jsxs(P,{type:"submit",className:"mt-4 w-full justify-center group disabled:opacity-70 disabled:cursor-not-allowed",disabled:l,children:[e.jsx("span",{className:"text-lg",children:l?d?"Registering...":"Signing In...":d?"Create Admin Account":"Sign In"}),!l&&e.jsx(H,{className:"group-hover:translate-x-1 transition-transform"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>{L(!d),t("")},className:"text-sage hover:text-terracotta transition-colors font-semibold text-sm flex items-center justify-center gap-2 mx-auto",children:d?e.jsx(e.Fragment,{children:"Already have an account? Login"}):e.jsxs(e.Fragment,{children:[e.jsx(W,{size:16})," Need an admin account? Register"]})})})]})]})]})};export{Z as default};
